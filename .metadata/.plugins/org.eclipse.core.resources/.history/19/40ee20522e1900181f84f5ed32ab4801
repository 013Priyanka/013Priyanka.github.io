package com.dtproject.model;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Component;

import com.dtproject.service.CartItemService;
import com.dtproject.service.ProductService;
import com.dtproject.service.ShippingService;
import com.dtproject.service.UserService;

@Component
public class FlowHandler 
{
	@Autowired
	private UserService userService;
	
	@Autowired
	private User user; 
	
	@Autowired
	private ProductService productService;
	
	@Autowired
	private CartItemService cartItemService;
	
	@Autowired
	private ShippingService shippingService;
	
	private List<ShippingAddress> addressList;
	public void initOrders()
	{
		System.out.println("init orders");
		String userName=SecurityContextHolder.getContext().getAuthentication().getName();
		user=userService.findUserByName(userName);
		
		
	}
	public Orders addTocart(int pId,int pQuantity,Orders order)
	{
		Product product=productService.findProductById(pId);
		List<CartItem> cartItem=cartItemService.findByCartId(user.getCartId());
		CartItem cart=null;
		int i=0;
		if(!cartItem.isEmpty())
		{
			for(CartItem citem:cartItem)
			{
				if(citem.getProductId()==pId)
				{
					cart.setQuantity(citem.getQuantity()+pQuantity);
					cart.setCartId(citem.getCartId());
					cart.setProductId(citem.getProductId());
					cart.setCartItem_id(citem.getCartItem_id());
					cart.setProductprice(cart.getQuantity()*product.getpPrice());
//					cart.setBillingAddress(citem.getBillingAddress());
//					cart.setShippingAddress(citem.getShippingAddress());
				i=1;
				}
				
			}
		}
		if(i==0)
		{
			cart.setProductId(product.getpId());
			cart.setCartId(user.getCartId());
			cart.setProductprice(product.getpPrice());
			cart.setQuantity(product.getpQuantity());
			
			
		}
		order.setCartItem(cart);
		
		return order;
		
	}
	 public String checkShippingAddress()
	 {
		 List<ShippingAddress> shippingAddress=shippingService.getAddressByUserName(user.getuName());
        if(shippingAddress.isEmpty())
        {
        	System.out.println("address list is empty");
        	return "empty";
        }
		 return 
	 }
}
