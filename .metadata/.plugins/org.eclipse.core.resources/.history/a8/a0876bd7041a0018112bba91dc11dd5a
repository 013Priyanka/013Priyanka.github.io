package com.dtproject.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

@Controller
public class CartController 
{
@RequestMapping("/addIntoCart")
private String addIntoCart(@RequestParam("pid") String productId,@RequestParam("quantity") String productQuantity)
{
	System.out.println("add into cart "+productId+" "+productQuantity);
	return "redirect:/myFlow?pid="+productId+"&quantity="+productQuantity;
	
}

@RequestMapping(value="cart")
public ModelAndView cart(HttpServletRequest request) {
	System.out.println("cart");
	ModelAndView mv = new ModelAndView();
	HttpSession session = request.getSession();
	User user = (User) session.getAttribute("activeUser");
	List<CartItem> cartItemList= cartItemService.getCartByUserId(user.getCartId());

	Map<CartItem,Product> map = new HashMap<CartItem,Product>();
	int total=0,item=0;
	
	for(CartItem c : cartItemList) {
		total=(int)c.getProductprice()+total;
		System.out.println(total);
		item=item+1;
		System.out.println(item);
		Product product= productService.findByProId(c.getProductId());
		map.put(c, product);
	}
	
	mv.addObject("total",total);
	mv.addObject("item",item);
	mv.addObject("itemList", map);
	mv.setViewName("cart");
	return mv;
}
}
