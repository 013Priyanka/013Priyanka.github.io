package com.dtproject.dao.daoImpl;

import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import com.dtproject.dao.CartDao;
import com.dtproject.model.BillingAddress;
import com.dtproject.model.Cart;
import com.dtproject.model.Orders;
import com.dtproject.model.Product;
import com.dtproject.model.ShippingAddress;
@Repository
public class CartDaoImpl implements CartDao
{
@Autowired
private SessionFactory sessionFactory;
	@Override
	public Cart findCartByCartId(int cartId) 
	{
		Session session=sessionFactory.openSession();
		Cart cart=(Cart) session.get(Cart.class, cartId);
		return cart;
	}
	@Override
	public void saveOrder(Orders order) 
	{
		Session session=sessionFactory.openSession();
		session.beginTransaction();
		int q=order.getCartItem().getQuantity();
		Product product=order.getProduct();
		product.setpQuantity(product.getpQuantity()-q);
		BillingAddress bA= order.getbAddress();
		ShippingAddress sA=order.getsAddress();
		session.save(bA);
		session.save(sA);
		order.setbAddress(bA);
		order.setsAddress(sA);
		session.saveOrUpdate(order);
		session.update(product);
		session.getTransaction().commit();
		session.close();
	}

}
